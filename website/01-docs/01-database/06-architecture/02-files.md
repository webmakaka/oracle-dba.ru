---
layout: page
title: Файлы базы данных Oracle
description: Файлы базы данных Oracle
keywords: Oracle Database, Файлы базы данных Oracle,
permalink: /docs/architecture/files/
---

# Файлы базы данных Oracle

<br/>

<div align="center">
<img src="https://img.oracledba.net/architecture/OracleDatabaseFiles.jpg" border="0" alt="Oracle Instance"><br/>
</div>

<br/>

Предполагается, что вы инсталлировали базу данных, согласно <a href="/database/installation/single-instance/simple/linux/6.3/oracle/11.2/">документа</a>.

<br/>

### Обязательные файлы:

<ul>
	<li><a href="#files1">Файлы данных (Data Files)</a></li>
	<li><a href="#files2">Оперативные файлы журналов повтора (Online Redo Log Files)</a></li>
	<li><a href="#files3">Управляющие файлы (Control Files)</a></li>
    <li><a href="#files4">Файлы параметров pfile, spfie (Parameter Files)</a></li>

</ul>

<br/><br/>

<h3>Необязательные файлы:</h3>

<ul>
	<li><a href="#files5">Архивные файлы журналов повтора (Archive Log Files)</a> (необязательные в том смысле, что база может быть настроена для работы без данных файлов)</li>
	<li><a href="#files6">Alert log и трассировочные файлы (trace file)</a> (Alertlog - можно удалить, трассировочные по умолчанию не создаются) </li>
	<li><a href="#files7">Файлы паролей (Password File)</a>(Обычно не используются)</li>
</ul>

<br/>

<h3><a name="files1">Файлы данных (Data Files)</a></h3>

Все данные в базе данных Oracle сохраняются в файлах данных. Все таблицы, индексы, триггеры, последовательности, программы на PL/SQL, представления - все это находится в файлах данных. И хотя эти и другие объекты базы данных логически содержатся в табличных пространствах, в действительности они сохраняются в файлах на жестком диске компьютера.<br/>

В каждой базе данных Oracle имеется по крайней мере один файл данных (но обычно их бывает больше). Если вы создаете в Oracle таблицу и заполняете ее строками, Oracle помещает эту таблицу и строки в файл данных. Каждый файл данных может быть связан только с одной базой данных.<br/>

У каждого файла данных имеется специальный формат, внутренний для программного обеспечения Oracle. Важно отдавать себе отчет в том, что файл данных состоит из заголовка и совокупности блоков. Заголовок файла данных Oracle содержит несколько структур, в том числе и идентификатор базы данных, номер и имя файла, тип файла, SCN создания и состояния файла.<br/>

Данные в файлы вносятся исключительно средствами Oracle.<br/>

Следующий запрос, покажет, где находятся файлы данных. <br/>

<br/>

```sql
SQL> set linesize 200;
SQL> set pagesize 0;
SQL> col  name format a40;
SQL> select file#, name, status from v$datafile;
```

<br/>

```
1 /u02/oradata/ora112/system01.dbf         SYSTEM
2 /u02/oradata/ora112/sysaux01.dbf         ONLINE
3 /u02/oradata/ora112/undotbs01.dbf        ONLINE
4 /u02/oradata/ora112/users01.dbf          ONLINE
5 /u02/oradata/ora112/my_indexes01.dbf     ONLINE
6 /u02/oradata/ora112/my_data01.dbf        ONLINE
```

<br/>
<h3><a name="files2">Оперативные файлы журналов повтора (Online Redo Log Files)</a></h3>

Оперативные файлы журналов повтора - предназначены для записи всех изменений, выполненных над данными базы данных Oracle. Используется для хранения на диске информации для повторного выполнения операций.<br/>

Для компьютера выполнить задачи повторно - означает выполнить ее точно так, как она выполнялась в предыдущий раз. Поэтому назначение оперативного файла журнала повтора заключается в сохранении информации об изменениях в базе данных таким, образом, чтобы позже их можно было повторить.<br/>

Каждая база данных должна иметь не менее двух оперативных файлов журналов повтора. Текущий файл постепенно заполняется, после его заполнения (или переключения некоторыми командами), база данных приступает к записи в следующий файл. Эта операция называется переключением журналов.<br/>

Поскольку файлы повтора необходимы для выполнения восстановления базы данных и являются критичными, их объединяют в группы. Запись происходит одновременно в файлы одной группы.<br/>

<br/>

```
SQL> set linesize 200;
SQL> set pagesize 0;
SQL> col  member format a50;
SQL> select group#, member from v$logfile order by group#;
```

<br/>

```
1 /u02/oradata/ora112/redo01.log
1 /u01/app/oracle/fast_recovery_area/redo01.log
2 /u01/app/oracle/fast_recovery_area/redo02.log
2 /u02/oradata/ora112/redo02.log
3 /u01/app/oracle/fast_recovery_area/redo03.log
3 /u02/oradata/ora112/redo03.log
```

<br/>
<h3><a name="files3">Управляющие файлы (Control Files)</a></h3>
<br/>

Поскольку база данных Oracle является физическим набором связанных файлов данных, то для их синхронизации и контроля требуется особые методы. Для этих целей используются управляющие файлы.<br/><br/>

База данных Oracle может иметь один или несколько управляющих файлов. Если имеется несколько управляющих файлов, все они должны быть абсолютно идентичными. При каждом запуске базы данных Oracle читает информацию управляющего файла, а при каждом изменении размещения или добавления новых файлов данных и журналов базы данных обновляет управляющий файл.<br/><br/>

```
SQL> set linesize 200;
SQL> set pagesize 0;
SQL> col  name format a100;
SQL> select name from v$controlfile;
```

<br/>

```
/u02/oradata/ora112/control01.ctl
/u02/oradata/ora112/control03.ctl
/u01/app/oracle/fast_recovery_area/ora112/control02.ctl
```

<br/>
<h3><a name="files4">Файлы параметров pfile, spfie (Parameter Files)</a></h3><br/>

Файлы параметров используются для конфигурирования действий Oracle предже всего при старте. Для того, чтобы запустить экземпляр базы данных, Oracle должен прочесть файл параметров и определить, какие параметры инициализации установлены для этого экземпляра. В файле параметров содержатся многочисленные параметры и их установленные значения. Oracle считывает файл параметров при запуске базы данных. Можно создать несколько файлов параметров, каждый будет соответствовать различным конфигурациям экземпляра.<br/><br/>

<ul>
    <li>spfile - бинарный файл, который используется сервером Oracle при старте.</li>
    <li>pfile - текстовый файл с параметрами, будет использоваться при старте, если не будет найден spfile.</li>
</ul>

<br/>

```
$ ls /u01/app/oracle/product/11.2/dbs/*.ora
/u01/app/oracle/product/11.2/dbs/init.ora
/u01/app/oracle/product/11.2/dbs/spfileora112.ora
```

<br/>

При старте, Oracle считает файл spfileora112.ora. (файл серверных параметров). Преимущество spfile заключается в том, что при работе с базой данных, любые изменения в базе касающиеся изменения параметра системы, автоматически записываются в данный файл.

Если используется pfile, для сохранения изменений, необходимо либо "руками вносить эти изменения" в текстовый файл, либо в консоли выполнять команды для создания данных файлов Ораклом.

<br/>

```
// создание pfile из памяти (в 11 версии Oracle)
SQL> create pfile from memory;
```

<br/>

```
// создать pfile из spfile
SQL> Create pfile from spfile;
```

<br/>

### Как я могу узнать, что моя база данных использует PFILE или SPFILE?

Выполните следующий запрос, чтобы увидеть какой файл параметров был использован:

```sql
SELECT DECODE(value, NULL, 'PFILE', 'SPFILE') "Init File Type"
FROM sys.v_$parameter WHERE name = 'spfile';
```

<br/>

```
Init F
------
SPFILE
```

<br/>

```
SQL> show parameter spfile;
```

<br/><br/>

```
NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
spfile                               string      /u01/app/oracle/product/11.2/d
                                                    bs/spfileora112.ora
```

<br/>
<h3><a name="files5">Архивные файлы журналов повтора (Archive Log Files)</a></h3>

Как только оперативный файл журнала повтора (Redolog) оказывается заполнен, программное обеспечение сервера Oracle начинает запись в следующий файл. Эта операция повторяется, как следствие информация в оперативных файлах журнала (Redolog) многократно перезаписывается.<br/>

Если необходимо сохранить историю изменений, нужно, чтобы после переключения журналов сохранялась их копия. Для этого достаточно перевести работу базы данных в режим работы ARCHIVELOG.<br/>

Архивные файлы журналов повтора жизненно важны при восстановлении. Если часть базы данных потеряна или повреждена, то для устранения повреждений обычно требуется несколько архивных журналов или туева хуча этих журналов. Файлы журналов повтора должны применяться к базе данных последовательно. Если один из архивных файлов журналов повтора пропущен, то остальные архивные файлы журналов не могут использоваться. Храните все свои архивные файлы журналов повтора с момента выполнения последней резервной копии. Файлы журналов постепенно накапливаются и разрастаются. Иногда необходимо их удалять. Все операции с данными файлами по применению их к базе выполняются исключительно средствами базы данных. А копировать и переносить их при желании можно как угодно. Бездумно удалять их руками не рекомендуется.<br/>

```
SQL> set linesize 200;
SQL> set pagesize 0;
SQL> col  name format a100;
SQL> select name from v$archived_log;
```

<br/>

```
...
/u01/app/oracle/fast_recovery_area/ORA112/archivelog/2011_11_22/o1_mf_1_11_7dq050f1_.arc
/u01/app/oracle/fast_recovery_area/ORA112/archivelog/2011_11_23/o1_mf_1_12_7dsykrjd_.arc
/u01/app/oracle/fast_recovery_area/ORA112/archivelog/2011_11_24/o1_mf_1_13_7dw3fy96_.arc
/u01/app/oracle/fast_recovery_area/ORA112/archivelog/2011_11_24/o1_mf_1_14_7dw3ys4f_.arc
/u01/app/oracle/fast_recovery_area/ORA112/archivelog/2011_11_26/o1_mf_1_15_7f04bqyq_.arc
...
```

<br/>
<h3><a name="files6">Alert log и трассировочные файлы (trace file)</a></h3>

При работе базы данных события и ошибки регистрируются в текстовых файлах на сервере базы данных. Файл журнала предупреждений (alert log) нужен администратору базы данных для отслеживания важнейших действий с базой данных - наподобие открытия и закрытия базы данных, установления параметров загрузки базы данных и переключения оперативных журналов повтора. Также в эти файлы записываются многие ошибки базы данных для последующего расследования их причин. Любые структурные изменения базы данных также регистрируются в файле журнала предупреждений.

<br/>

```
// в 11 версии базы данных по умолчанию:
$ ls /u01/app/oracle/diag/rdbms/rdb115/RDB115/trace
alert_${SID_NAME}.log
```

<br/>

```
// в 11 версии появилась XML версия. По умолчанию:
$ ls /u01/app/oracle/diag/rdbms/ora112/ora112/alertlog.xml
```

<br/>

Когда возникает ошибка базы данных, может генерироваться файл трассировки (trace file). Они содержит подробную информацию о возникновении ошибки.

<br/>

```
// в 11 версии базы данных по умолчанию трассировочные файлы хранятся
/u01/app/oracle/diag/rdbms/ora112/ora112/trace
```

<br/>

```
// Следующая команда выведет информацию по расположению трассировочных файлов
SQL> show parameter dump_dest
```

<br/>
<h3><a name="files7">Файлы паролей (Password File)</a></h3>

Необязательный файл, используется для защиты информации о подключениях привилегированных пользователей. Если отсутствует, то вы можете выполнять администрирование своей базы данных, только локально. Кроме того, с его помощью контролируется количество привилегированных подключений для управления в одно и то же время.

<br/>

```
$ ls /u01/app/oracle/product/11.2/dbs/orapw*
/u01/app/oracle/product/11.2/dbs/orapwora112
```
