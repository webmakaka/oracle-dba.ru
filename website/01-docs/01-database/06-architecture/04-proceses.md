---
layout: page
title: Процессы Oracle
description: Структуры памяти Oracle
keywords: Oracle Database, Память
permalink: /docs/architecture/proceses/
---

<div style="padding:10px; border:thin solid black;">

    <h3>Получил письмо от правообладателя Елена Савельева <saveljeva.williamspublishing@gmail.com></h3>

    <br/>

    Здравствуйте. Вы опубликовали на своем сайте материалы из книги нашего издательства:

    <br/>

    Oracle Database 11g: руководство администратора баз данных. : Пер. с англ. — М. : ООО “И.Д. Вильямс”, 2010. — 1440 с. : ил. — Парал. тит. англ.
    	ISBN 978-5-8459-1592-4 (рус.)

    <br/>

    Не имея на то никаких прав. Требует удалить публикацию во избежание судебного иска и блокировки сайта Роскомнадзором. Требуем также удалить другие материалы из книг нашего издательства с Вашего сайта.

    <br/>

    Требуем произвести удаление до 7 сентября 2018 года. "Не получение" этого письма не освобождает Вас от ответственности. Понятно, да?

</div>

<br/><br/>

<div style="padding:10px; border:thin solid black;">

    Книга лежит в общем доступе на торрент-трекерах уже более 4 лет. Да, книга как по мне, так хорошая. Лучшая, из того что попадалось. Впрочем материал в ней ориентируется на базу версии 11.1. т.е. на базу десятилетней давности.

    <br/>

    Если нужно что-то купить, а жаба душит. Есть сайт skladchik(.)com, на котором вы можете разделить расходы на покупку между заинтересованными людьми.

</div>

<br/>

# Процессы Oracle

Попробуем самостоятельно переписать материал. Нужно отметить, что в книге он был описан достаточно сложно.

Если вы собираетесь сдавать экзамен, то вам лучше обратиться по этой теме к другому источнику. (Или лучше поправить неточности записанные ниже).

<br/>

Получить информацию о процессах в Linux, можно выполнив команду:

    $ ps -eaf | grep ora112

<br/>

    oracle11  2722     1  0  2011 ?        01:02:06 ora_pmon_ora112
    oracle11  2726     1  0  2011 ?        00:39:42 ora_psp0_ora112
    oracle11  2730     1  0  2011 ?        05:12:43 ora_vktm_ora112
    oracle11  2736     1  0  2011 ?        00:32:43 ora_gen0_ora112
    oracle11  2740     1  0  2011 ?        00:22:40 ora_diag_ora112
    oracle11  2744     1  0  2011 ?        00:35:09 ora_dbrm_ora112
    oracle11  2748     1  0  2011 ?        01:14:24 ora_dia0_ora112
    oracle11  2752     1  0  2011 ?        00:31:44 ora_mman_ora112
    oracle11  2756     1  0  2011 ?        00:46:33 ora_dbw0_ora112
    oracle11  2760     1  0  2011 ?        00:40:06 ora_lgwr_ora112
    oracle11  2764     1  0  2011 ?        01:28:04 ora_ckpt_ora112
    oracle11  2768     1  0  2011 ?        00:18:38 ora_smon_ora112
    oracle11  2772     1  0  2011 ?        00:15:23 ora_reco_ora112
    oracle11  2776     1  0  2011 ?        01:30:37 ora_mmon_ora112
    oracle11  2780     1  0  2011 ?        01:15:35 ora_mmnl_ora112
    oracle11  2784     1  0  2011 ?        00:15:53 ora_d000_ora112
    oracle11  2788     1  0  2011 ?        00:16:04 ora_s000_ora112
    oracle11  2838     1  0  2011 ?        00:33:21 ora_rvwr_ora112
    oracle11  2845     1  0  2011 ?        00:16:10 ora_arc0_ora112
    oracle11  2849     1  0  2011 ?        00:17:40 ora_arc1_ora112
    oracle11  2853     1  0  2011 ?        00:15:52 ora_arc2_ora112
    oracle11  2857     1  0  2011 ?        00:15:55 ora_arc3_ora112
    oracle11  2861     1  0  2011 ?        00:17:30 ora_qmnc_ora112
    oracle11  2992     1  0  2011 ?        01:13:39 ora_cjq0_ora112
    oracle11  3027     1  0  2011 ?        00:17:59 ora_q000_ora112
    oracle11  3031     1  0  2011 ?        00:15:07 ora_q001_ora112
    oracle11  3083     1  0  2011 ?        00:32:57 ora_smco_ora112
    oracle11  5167     1  0 Jan24 ?        00:00:02 oracleora112 (LOCAL=NO)
    oracle11 16833     1  0 14:42 ?        00:00:00 ora_w000_ora112
    oracle11 16866  5073  0 14:46 pts/0    00:00:00 grep ora112

<br/>

Посмотреть все доступные фоновые процессы Oracle можно, выполнив запрос к представлению v\$BGPROCESS

    SQL> SELECT name, description FROM v$BGPROCESS ORDER BY 1;

<br/>

    SQL> SELECT pname FROM v$PROCESS;

<br/>

Есть обязательные процессы, без которых oracle работать не сможет и необязательные.
Процесс отвечающий за подключение к базе данных и для работы пользователя с ней - не является обязательным.

Обязательные процессы запускаются при старте экземпляра и остаются активными на все время его жизни.

Далее перечислим наиболее важные процессы (остальных как-то совсем не приходилось касаться):

<ul>
	<li> DBWn (DataBase Writer) - записывает модифицированные данные из буферного кэша в файлы данных</li>
	<li> LGWR (Log Writer) - записывает содержимое redolog буфера в redolog файлы.</li>
	<li> ARCn (Archiver) – архивирует заполненные redolog журналы если такая опция включена. Не является обязательным. Жрет доп. ресурсы. Зато можно восстановить базу к любому времени когда эта опция включена. (упрощенно)</li>
	<li> CKPT (checkpoint) – отвечает за создание контрольных точек</li>
	<li> PMON (Process Monitor) – мониторит процессы и восстанавливает работу процессов в случае их сбоя</li>
	<li> SMON (System Monitor) – отвечает за восстановление системы в случае сбоев</li>
	<li>MMON (manageability monitor) - сбор статистики</li>
  <li> .... </li>

</ul>

<br/>

### DBWn (DataBase Writer) - записывает изменения в файлы данных

Файлы данных:

    SQL> select file#, name, status from v$datafile;

Процесс DBWn пишет изменения в данные файлы.

Но делает это при выполнении следующих условий:

1. Каждые 3 секунды <br/>
2. При создании контрольной точки<br/>
3. Когда некуда записывать изменения.

<br/>

### LGWR (Log Writer) - записывает изменения в redolog файлы

При изменениях в таблице базы данных (INSERT, UPDATE, DELETE), Oracle записывает зафиксированные и незафиксированные изменения в redo буфер в памяти.

После LGWR записывает эти изменения в redolog файлы.

    SQL> select group#, member from v$logfile order by group#;

Но делает это не сразу а при выполнении следующих условий:

<ul>
	<li> Каждые 3 секунды</li>
	<li> Сразу после фиксации транзакции</li>
	<li> Когда redolog буфер заполнен на треть (??? так написано, я сам хз.)</li>
	<li> DBWn (DataBase Writer) - сообщает о необходимости записи redolog журнала на диск. DBWn сигнализирует LGWR, чтобы тот сначала записал свою информацию, чтобы потом DBWn мог записать на диск свою собственную информацию.</li>
	<li>Пользователь вводит команды вроде: alter system switch logfile для переключения группы</li>

</ul>

Запись выполняется во все файлы входящие в группу. Обычно делают 3 группы по 2 файла.

Пример. В первой группе 2 одинаковых файла. В оба LGWR должен записать одно и тоже. Если ему не удастся это сделать, работа базы будет остановлена.

Если непонятно написано, см. пример установки oracle. Там и добавление файлов в группы и переключение и д.р.

<br/>

### ARCn - записывает изменения в archivelog файлы (если включен)

    SQL> select name from v$archived_log;

При включенном режиме работы Archivelog, копия redolog журнала сохраняется на диске и при этом еще и архивируется.

Вот собственно этот процесс и занимается этим.

<br/>

### CKPT (checkpoint)

Отвечает за синхронизацию информации буферного кэша с информацией на диске.

CKPT сообщает DBWn, что ему следует записывать «грязные» данные в файлы на диск.

После этого он обновляет заголовки файла данных и control файла, внося туда детали контрольной точки.

Каждая запись контрольной точки состоит из списка всех активных транзакций и адреса последней записи журнала для этих транзакций.

Что происходит при создании контрольной точки:

1. Запись содержимого буферов redolog в redolog файлы<br/>
2. Внесение записи контрольной точки в redolog файл<br/>
3. Запись буферного кэша в файл данных<br/>
4. Обновление заголовков файла данных и control файлов после завершения контрольной точки. <br/>

Контрольную точку можно создать самостоятельно и при необходимости откатиться на нее.

    SQL> alter system checkpoint;
    SQL> alter system switch logfile;

<br/>

Контрол файлы лежат здесь:

    SQL> select name from v$controlfile;

<br/>

### PMON (Process Monitor)

Следит, чтобы умершие пользовательские процессы не блокировали ресурсы.

<br/>

### SMON (System Monitor)

Из названия следует, что процесс периодически мониторит все ли хорошо с базой.

При перезапуске экземпляра, SMON определяет целостность базы данных

<br/>

### MMON (manageability monitor)

Собирает статистики позволяющие диагностировать работу базы данных. Такие как AWR

<br/>

И д.р.

При использовании ASM, RAC, DataGuard задействованы и другие процессы.

<br/>

### P.S.Процессы слушателя (Listener), которые используются для удаленного подключения к базе данных здесь не рассматриваются
